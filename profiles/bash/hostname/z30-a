export-if-exists GOPATH "${HOME}/go"
source-environment go

source-environment git
source-environment cpp
source-environment moncli

export-if-exists DROPBOX $HOME/Dropbox
run-if-not-empty DROPBOX "source-environment dropbox"

export-if-exists CYCLING_ROUTES_ARCHIVE "$DROPBOX/cycling/Routes"
export-if-exists CYCLING_ACTIVITIES_ARCHIVE "$DROPBOX/cycling/activities"
export GARMIN_MOUNT=/media/$USER/GARMIN
source-environment garmin-strava

juce-make-run(){ 
	local juceProjectsDir="$HOME/JUCE/projects"
	make -C "$juceProjectsDir/$1/Builds/LinuxMakefile" && "$juceProjectsDir/$1/Builds/LinuxMakefile/build/$1"
}

alias graphitbro='make -C $HOME/Dropbox/money/graphitbros'

install-mon-commands() {
	local version="$1"
	if [[ -z "$version" ]]; then
		echo usage: install-mon-commands VERSION
		return 1
	fi
	wget https://github.com/glynternet/mon/releases/download/v${version}/mon_${version}_linux_amd64.tar.gz \
		--output-document=/tmp/mon_${version}_linux_amd64.tar.gz
	local code=$?
	if [[ "$code" != 0 ]]; then
		echo wget exited with code "$code"
		return 2
	fi
	( cd /tmp && tar -zxvf ./mon_${version}_linux_amd64.tar.gz )
	sudo mv -v /tmp/moncli /tmp/monserve /usr/local/bin/
}


music-copy-and-archive() {
	local usage="Usage: music-copy-and-archive <file>"
	local file="${1:?$usage}"
	cp -vr "$file" "$HOME/Music/"
	mv -v "$file" "$HOME/Downloads/Music/"
}

copy-args() {
	echo "$@" | copy
}

calc() {
	echo "scale=3; $@" | bc
}

cp-extract-rar(){(
	set -e
	local usage='usage: cp-extract-rar <rar_archive>
	
	Copies a rar archive to the working directory
	and extracts it into its own directory'
	local archive="${1:?"$usage"}"
	local archiveCopy="$(basename "$archive")"
	cp -v "$archive" "$archiveCopy"
	extract-rar "$archiveCopy"
	trash "$archiveCopy"
)}

mon-insert-oppose(){
	local usage='usage: mon-move-amount AMOUNT ACCOUNT_INSERT ACCOUNT_OPPOSE [DATE=0]'
	local amount="${1:?$usage}"
	local insertAccount="${2:?$usage}"
	local opposeAccount="${3:?$usage}"
	local date="${4:-0}"

	moncli account balance-insert "$insertAccount" -a "$amount" -d "$date"
	moncli account balance-insert "$opposeAccount" -a "$(echo "$amount * -1" | bc)" -d "$date"
}
